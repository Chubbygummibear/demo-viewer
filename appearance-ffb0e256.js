define(["exports"],(function(e){"use strict";function a(e,a){let r=e[0],l=e[3],t=e[1],i=e[4],n=e[2],o=e[5],p=a[0],_=a[3],f=a[1],s=a[4],c=a[2],d=a[5];return e[0]=r*p+_*t,e[3]=p*l+_*i,e[1]=r*f+t*s,e[4]=l*f+i*s,e[2]=n+r*c+t*d,e[5]=l*c+o+i*d,e}function r(e){let a=e[0],r=e[3],l=e[1],t=e[4],i=e[2],n=e[5],o=a*t-r*l;if(0!=o)return e[0]=t/o,e[3]=r/-o,e[1]=l/-o,e[4]=a/o,e[2]=(t*i-l*n)/-o,e[5]=(r*i-a*n)/o,e}e.Appearance=void 0,function(e){function l(e){if(e.sorted_appearances)return e.sorted_appearances;let a=[];for(let r of e.underlays)r=t(e,r),a.push(...l(r));a.push(e);for(let r of[...e.overlays].sort(((a,r)=>{let l=a.layer<0?e.layer:a.layer,t=r.layer<0?e.layer:r.layer;if(l<t)return l-t;let i=a.layer<0?a.layer:-1,n=r.layer<0?r.layer:-1;return i<n?i-n:0})))r=t(e,r),a.push(...l(r));return e.sorted_appearances=a,a}function t(e,r){let l=!1,t=()=>{l||(l=!0,r=Object.assign({},r))};var i;if(r.dir||(t(),r.dir=e.dir),(e.pixel_x||e.pixel_y||e.pixel_z||e.pixel_w&&!(8&e.appearance_flags))&&(t(),r.pixel_x+=e.pixel_x,r.pixel_y+=e.pixel_y,r.pixel_z+=e.pixel_z,r.pixel_w+=e.pixel_w),8&e.appearance_flags||1==(i=e.transform)[0]&&0==i[1]&&0==i[2]&&0==i[3]&&1==i[4]&&0==i[5]||(t(),r.transform=[...r.transform],a(r.transform,e.transform)),4278190080!=(4278190080&e.color_alpha)&&!(4&e.appearance_flags)){t();let a=Math.round((e.color_alpha>>>24)*(r.color_alpha>>>24)/255);r.color_alpha=16777215&r.color_alpha|a<<24}if(16777215!=(16777215&e.color_alpha)&&!(2&e.appearance_flags)){t();let a=4278190080&r.color_alpha;for(let l=0;l<24;l+=8){a|=Math.round((e.color_alpha>>>l&255)*(r.color_alpha>>>l&255)/255)<<l}r.color_alpha=a}return r}e.resolve_plane=function e(a,r=0){return(r<-1e4||r>1e4)&&(r=e(r)),(a<-1e4||a>1e4)&&(a=r+a+32767<<16>>16),a},e.get_appearance_parts=l,e.overlay_inherit=t,e.get_display_boundary=function(e){var a,r,t,i,n,o;let p=1/0,_=-1/0,f=1/0,s=-1/0;for(let c of l(e)){let e=null!==(t=null===(r=null===(a=c.icon_state_dir)||void 0===a?void 0:a.atlas_node)||void 0===r?void 0:r.width)&&void 0!==t?t:32,l=null!==(o=null===(n=null===(i=c.icon_state_dir)||void 0===i?void 0:i.atlas_node)||void 0===n?void 0:n.height)&&void 0!==o?o:32;for(let a of[-.5,.5])for(let r of[-.5,.5]){let t=c.transform[0]*a*e+c.transform[1]*r*l+c.transform[2]+.5*e+c.pixel_x+c.pixel_w,i=c.transform[3]*a*e+c.transform[4]*r*l+c.transform[5]+.5*l+c.pixel_y+c.pixel_z;p=Math.min(p,t),_=Math.max(_,t),f=Math.min(f,i),s=Math.max(s,i)}}return p>_||f>s?{x:0,y:0,width:0,height:0}:{x:p,y:f,width:_-p,height:s-f}},e.check_appearance_click=function(e,a,t,i=!1){var n;let o=l(e);for(let e=o.length-1;e>=0;e--){let l=i?2:1;if(0==l)continue;let p=o[e],_=r([...p.transform]);if(!_)continue;let f=null===(n=p.icon_state_dir)||void 0===n?void 0:n.current_frame;if(!f&&l<=1)continue;let s=32,c=32;f&&(s=f.sprite_data.width,c=f.sprite_data.height);let d=a-s/2-p.pixel_x-p.pixel_w,u=t-c/2-p.pixel_y-p.pixel_z,h=d*_[0]+u*_[1]+_[2]+s/2,x=d*_[3]+u*_[4]+_[5]+c/2;if(!(h<0||x<0||h>=s||x>=c)&&!(l<=1&&f&&0==f.sprite_data.data[4*(Math.floor(c-x)*s+Math.floor(h))+3]))return!0}return!1}}(e.Appearance||(e.Appearance={})),e.ReaderAppearance=void 0,(e.ReaderAppearance||(e.ReaderAppearance={})).base={icon:null,icon_state:null,name:null,appearance_flags:0,layer:2,plane:-32767,dir:2,color_alpha:-1,pixel_x:0,pixel_y:0,pixel_z:0,pixel_w:0,blend_mode:0,glide_size:8,transform:[1,0,0,0,1,0],invisibility:0,overlays:[],underlays:[]},e.LONG_GLIDE=1,e.MAX_LAYER=32,e.matrix_multiply=a,e.matrix_translate=function(e,a=0,r=0){return e[2]+=a,e[5]+=r,e}}));
